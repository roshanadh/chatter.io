<!DOCTYPE html>
<html>
    <head>
        <title>Chatter.IO</title>
    </head>
    <style>
        
        #message-container{
            /* position: absolute;
            bottom: 30px; */
        }

        .message{
            display: inline-block;
            border-radius: 5px;
            padding-top: 5px;
            padding-bottom: 5px;
            padding-left: 15px;
            padding-right: 15px;
            max-width: 200px;
            margin: 5px;
            background-color: cyan;
            opacity: 0.8; 
        }

    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        /* Joining the default namespace */
        var socket = io();
        let username = '';
        /*
            ~ Event handlers ~
        */
        socket.on('userSet', (data) => {
            var logBox = document.getElementById('log-container');
            var input = document.getElementById('username');
            var button = document.getElementById('btnSend');
            input.id = 'message';
            input.value = '';
            input.placeholder = 'Type your message';
            button.innerText = 'Send Message';
            button.onclick = sendMessage;
            logBox.innerHTML += "<div style='color:green;'>SUCCESS - <i>" + username + "</i> has been logged in!";

        });

        socket.on('newUser', (data) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += "<div style='text-align: center; color: blue;'><b>" + data.username + "</b> has entered the chat!</div>"; 
        });

        socket.on('usernameExists', (data) => {
            var logBox = document.getElementById('log-container');
            logBox.innerHTML += "<div style='color:red;'>ERROR - <i>" + username + "</i> already taken!";
        });

        socket.on('newMsg', (data) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += "<div class='message'><b>"+ data.user + "</b>: " + data.message + "</div><br>";
        });

        socket.on('userLeft', (username) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += "<div style='text-align: center; color: red;'><b>" + username + "</b> has left the chat!</div>";
        });

        function setUsername(){
            var msgBox = document.getElementById('message-container');
            username = document.getElementById('username').value;
            if(username.trim() != '')
                socket.emit('setUsername', username);
            else
            msgBox.innerHTML += "<div style='text-align: center; color: red;'><b>Username cannot be empty!</b></div>";
        }

        function sendMessage(){
            var message = document.getElementById('message').value;
            var user = username;

            socket.emit('msg', {user: user, message: message});
        }

    </script>
    <body>
        <input type="text" id="username" placeholder="Enter your username">
        <button type="button" id="btnSend" name="btnSend" onclick="setUsername()" value="Log In">Log In</button>
        <div id="log-container"></div>
        <div id="message-container"></div>
    </body>
</html>