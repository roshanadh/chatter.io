<!DOCTYPE html>
<html>
    <head>
        <title>Chatter.IO</title>
    </head>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        /* Joining the default namespace */
        var socket = io();
        let username = '';
        /*
            ~ Event handlers ~
        */
        socket.on('userSet', (data) => {
            var logBox = document.getElementById('log-container');
            var input = document.getElementById('username');
            var button = document.getElementById('btnSend');
            input.id = 'message';
            input.value = '';
            input.placeholder = 'Type your message';
            button.innerText = 'Send Message';
            button.onclick = sendMessage;
            logBox.innerHTML += "<div style='color:green;'>SUCCESS - <i>" + username + "</i> has been logged in!";

        });

        socket.on('newUser', (data) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += "<div style='text-align: center; color: blue;'><b>" + data.username + "</b> has entered the chat!</div>"; 
        });

        socket.on('usernameExists', (data) => {
            var logBox = document.getElementById('log-container');
            logBox.innerHTML += "<div style='color:red;'>ERROR - <i>" + username + "</i> already taken!";
        });

        socket.on('newMsg', (data) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += '<div><b>' + data.user + '</b>: ' + data.message + '</div>';
        });

        socket.on('userLeft', (username) => {
            var msgBox = document.getElementById('message-container');
            msgBox.innerHTML += "<div style='text-align: center; color: red;'><b>" + username + "</b> has left the chat!</div>";
        })
        function setUsername(){
            username = document.getElementById('username').value;
            socket.emit('setUsername', username);
        }

        function sendMessage(){
            var message = document.getElementById('message').value;
            var user = username;

            socket.emit('msg', {user: user, message: message});
        }

    </script>
    <body>
        <input type="text" id="username" placeholder="Enter your username">
        <button type="button" id="btnSend" name="btnSend" onclick="setUsername()" value="Log In">Log In</button>
        <div id="log-container"></div>
        <div id="message-container"></div>
    </body>
</html>